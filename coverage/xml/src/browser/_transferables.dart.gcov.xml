<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?xml-stylesheet type="text/xsl" href="../../jgenhtml.xsl"?><coverage branch-rate="NaN" branches-covered="0" branches-valid="0" complexity="0" date="2023-03-02" filename="_transferables.dart" function-rate="NaN" functions-covered="0" functions-valid="0" line-rate="0.90909094" lines-covered="30" lines-valid="33" package="/src/browser" testname="lcov.info" version="1.5">
    <lines>
        <line>
            <code>import '../squadron_error.dart';</code>
        </line>
        <line>
            <code/>
        </line>
        <line>
            <code>class Transferables {</code>
        </line>
        <line>
            <code>  const Transferables._();</code>
        </line>
        <line>
            <code/>
        </line>
        <line hits="1">
            <code>  static Iterable&lt;Object&gt; get(Map args) =&gt; _get(args, &lt;Object&gt;{});</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code/>
        </line>
        <line hits="1">
            <code>  static bool _isBaseType(dynamic data) =&gt;</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>      (data == null || data is String || data is num || data is bool);</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code/>
        </line>
        <line>
            <code>  static bool _isListOfBaseType(dynamic data) =&gt;</code>
        </line>
        <line hits="1">
            <code>      (data is List&lt;String&gt; || data is List&lt;num&gt; || data is List&lt;bool&gt;);</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code/>
        </line>
        <line hits="1">
            <code>  static bool _isSafeForTransfer(dynamic data) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    if (_isBaseType(data)) return true;</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="0">
            <code>    if (_isListOfBaseType(data)) return true;</code>
        </line>
        <line hits="1">
            <code>    if (data is List &amp;&amp; data.every(_isSafeForTransfer)) return true;</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    return false;</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>  }</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code/>
        </line>
        <line hits="1">
            <code>  static bool _isNotSafeForTransfer(dynamic data) =&gt; !_isSafeForTransfer(data);</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code/>
        </line>
        <line>
            <code>  /// Excludes base type values from [list].</code>
        </line>
        <line hits="1">
            <code>  static Iterable&lt;Object&gt; _getObjects(Iterable list, Set&lt;Object&gt; seen) sync* {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    for (var o in list.where(_isNotSafeForTransfer)) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>      if (!seen.contains(o)) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>        seen.add(o);</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>        yield o as Object;</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code>      }</code>
        </line>
        <line>
            <code>    }</code>
        </line>
        <line hits="1">
            <code>  }</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code/>
        </line>
        <line hits="1">
            <code>  static void _checkKeys(Map data) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    if (!data.keys.every(_isBaseType)) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="0">
            <code>      throw newSquadronError('Map keys must be strings, numbers or booleans.');</code>
        </line>
        <line>
            <code>    }</code>
        </line>
        <line hits="1">
            <code>  }</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code/>
        </line>
        <line>
            <code>  /// Yields objects contained in [message]. Used to identify non-base type objects and provide them</code>
        </line>
        <line>
            <code>  /// to [web.Worker.postMessage]. [web.Worker.postMessage] will clone these objects. The code makes</code>
        </line>
        <line>
            <code>  /// no effort to ensure these objects really are transferable.</code>
        </line>
        <line hits="1">
            <code>  static Iterable&lt;Object&gt; _get(Map message, Set&lt;Object&gt; seen) sync* {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    _checkKeys(message);</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    if (_isSafeForTransfer(message)) return;</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    final toBeInspected = &lt;Object&gt;[];</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>    toBeInspected.addAll(_getObjects(message.values, seen));</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code>    var i = 0;</code>
        </line>
        <line hits="1">
            <code>    while (i &lt; toBeInspected.length) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code>      final arg = toBeInspected[i++];</code>
        </line>
        <line hits="1">
            <code>      if (arg is Map) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code>        _checkKeys(arg);</code>
        </line>
        <line hits="0">
            <code>        toBeInspected.addAll(_getObjects(arg.values, seen));</code>
        </line>
        <line hits="1">
            <code>      } else if (arg is Iterable) {</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line hits="1">
            <code>        toBeInspected.addAll(_getObjects(arg, seen));</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code>      } else {</code>
        </line>
        <line hits="1">
            <code>        yield arg;</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code>      }</code>
        </line>
        <line>
            <code>    }</code>
        </line>
        <line hits="1">
            <code>  }</code>
            <hit count="1" name="&lt;unnamed&gt;"/>
        </line>
        <line>
            <code>}</code>
        </line>
    </lines>
    <config branch-coverage="true" description-file="false" function-coverage="true" genhtml_hi_limit="90" genhtml_med_limit="75" legend="false" no-sort="false" no-source="false"/>
    <base href="../../"/>
    <base href="../../"/>
</coverage>
